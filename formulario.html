import React, { useState } from 'react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';

const productos = [
  {
    id: 1,
    nombre: 'Producto 1',
    descripcion: 'Descripción Producto 1',
    precio: 10.00
  }
  // Puedes agregar más productos aquí
];

const ReservationForm = () => {
  const [formData, setFormData] = useState({
    fechaHora: '',
    cantidadPersonas: '',
    nombre: '',
    apellidos: '',
    celular: '',
    email: '',
    comentarios: ''
  });

  const [carrito, setCarrito] = useState(
    productos.map(producto => ({
      ...producto, 
      cantidad: 0
    }))
  );

  const handleFormChange = (e) => {
    const { name, value } = e.target;
    setFormData(prevState => ({
      ...prevState,
      [name]: value
    }));
  };

  const handleCantidadChange = (productoId, cantidad) => {
    setCarrito(prevCarrito => 
      prevCarrito.map(item => 
        item.id === productoId 
          ? { ...item, cantidad: Math.max(0, cantidad) }
          : item
      )
    );
  };

  const calcularSubtotal = (producto) => {
    return producto.precio * producto.cantidad;
  };

  const calcularTotal = () => {
    return carrito.reduce((total, producto) => 
      total + calcularSubtotal(producto), 0
    );
  };

  const generarMensajeWhatsApp = () => {
    let mensaje = "🛒 *Formulario de Reserva*\n\n";
    
    // Datos personales
    mensaje += `*Datos Personales:*\n`;
    mensaje += `Fecha y Hora: ${formData.fechaHora}\n`;
    mensaje += `Cantidad de Personas: ${formData.cantidadPersonas}\n`;
    mensaje += `Nombre: ${formData.nombre}\n`;
    mensaje += `Apellidos: ${formData.apellidos}\n`;
    mensaje += `Celular: ${formData.celular}\n`;
    mensaje += `E-mail: ${formData.email}\n`;
    mensaje += `Comentarios: ${formData.comentarios}\n\n`;
    
    // Productos
    mensaje += `*Productos:*\n`;
    carrito.filter(p => p.cantidad > 0).forEach(producto => {
      mensaje += `${producto.nombre} - Cantidad: ${producto.cantidad} - Subtotal: $${calcularSubtotal(producto).toFixed(2)}\n`;
    });
    
    mensaje += `\n*Total:* $${calcularTotal().toFixed(2)}`;

    // Codificar el mensaje para WhatsApp
    const mensajeEncoded = encodeURIComponent(mensaje);
    const whatsappUrl = `https://wa.me/TUNUMERODEWHATSAPP?text=${mensajeEncoded}`;
    
    window.open(whatsappUrl, '_blank');
  };

  return (
    <div className="max-w-md mx-auto p-4 bg-white shadow-md rounded-lg">
      <h2 className="text-2xl font-bold mb-4">Formulario de Reservas</h2>
      
      {/* Información Personal */}
      <div className="space-y-4">
        <div>
          <Label>Fecha y Hora</Label>
          <Input 
            type="datetime-local" 
            name="fechaHora"
            value={formData.fechaHora}
            onChange={handleFormChange}
          />
        </div>
        <div>
          <Label>Cantidad de Personas</Label>
          <Input 
            type="number" 
            name="cantidadPersonas"
            value={formData.cantidadPersonas}
            onChange={handleFormChange}
            min="1"
          />
        </div>
        <div>
          <Label>Nombre</Label>
          <Input 
            name="nombre"
            value={formData.nombre}
            onChange={handleFormChange}
          />
        </div>
        <div>
          <Label>Apellidos</Label>
          <Input 
            name="apellidos"
            value={formData.apellidos}
            onChange={handleFormChange}
          />
        </div>
        <div>
          <Label>Celular</Label>
          <Input 
            type="tel" 
            name="celular"
            value={formData.celular}
            onChange={handleFormChange}
          />
        </div>
        <div>
          <Label>E-mail</Label>
          <Input 
            type="email" 
            name="email"
            value={formData.email}
            onChange={handleFormChange}
          />
        </div>
        <div>
          <Label>Comentarios</Label>
          <Textarea
            name="comentarios"
            value={formData.comentarios}
            onChange={handleFormChange}
          />
        </div>
      </div>

      {/* Carrito de Productos */}
      <div className="mt-6">
        <h3 className="text-xl font-semibold mb-4">Productos</h3>
        {carrito.map(producto => (
          <div key={producto.id} className="flex items-center mb-4 space-x-4">
            <div className="flex-grow">
              <h4 className="font-medium">{producto.nombre}</h4>
              <p className="text-sm text-gray-500">{producto.descripcion}</p>
              <p className="text-sm">Precio: ${producto.precio.toFixed(2)}</p>
            </div>
            <div className="flex items-center space-x-2">
              <Button 
                variant="outline" 
                size="sm"
                onClick={() => handleCantidadChange(producto.id, producto.cantidad - 1)}
              >
                -
              </Button>
              <Input 
                type="number" 
                value={producto.cantidad}
                onChange={(e) => handleCantidadChange(producto.id, parseInt(e.target.value))}
                className="w-16 text-center"
                min="0"
              />
              <Button 
                variant="outline" 
                size="sm"
                onClick={() => handleCantidadChange(producto.id, producto.cantidad + 1)}
              >
                +
              </Button>
            </div>
          </div>
        ))}

        {/* Resumen de Compra */}
        <div className="mt-4 border-t pt-4">
          <div className="flex justify-between">
            <span>Total:</span>
            <span className="font-bold">${calcularTotal().toFixed(2)}</span>
          </div>
        </div>
      </div>

      {/* Botón de Envío */}
      <Button 
        className="w-full mt-6"
        onClick={generarMensajeWhatsApp}
      >
        Enviar por WhatsApp
      </Button>
    </div>
  );
};

export default ReservationForm;