<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotiza tus C√≥cteles</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
</head>
<body>
  <div id="app" class="container py-4">
    <h1 class="text-center mb-4">Cotiza tus C√≥cteles</h1>
    
    <div class="alert alert-info mb-4">
      <p class="mb-1"><strong>*Cada barril de 5 Litros rinde entre 25 y 30 c√≥cteles.</strong></p>
      <p class="mb-0"><strong>*Cada Barril de 10 Litros rinde entre 50 y 60 c√≥cteles.</strong></p>
    </div>

    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
      <!-- Productos -->
      <div v-for="(producto, index) in productos" :key="index" class="col">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <h5 class="card-title fw-bold">{{ producto.nombre }}</h5>
              <h5 class="fw-bold" v-if="producto.cantidad > 0">${{ formatPrice(producto.subtotal) }}</h5>
              <h5 class="text-muted" v-else>$0</h5>
            </div>
            <p class="card-text text-muted small">{{ producto.descripcion }}</p>
            
            <select class="form-select mb-2" v-model="producto.tamanoSeleccionado" @change="actualizarPrecio(producto)">
              <option v-for="tamano in producto.tamanos" :key="tamano.id" :value="tamano">
                {{ tamano.nombre }} - ${{ formatPrice(tamano.precio) }}
              </option>
            </select>
            
            <div class="d-flex align-items-center gap-2 mt-3">
              <button class="btn btn-outline-secondary" @click="decrementarCantidad(producto)" :disabled="producto.cantidad <= 0">-</button>
              <input type="text" class="form-control text-center" v-model="producto.cantidad" @input="validarCantidad(producto)" @change="calcularSubtotal(producto)">
              <button class="btn btn-outline-secondary" @click="incrementarCantidad(producto)">+</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-body">
            <form @submit.prevent="enviarCotizacion">
              <h5 class="card-title mb-3">Datos de Contacto</h5>
              
              <div class="mb-3">
                <label for="fechaHora" class="form-label">Fecha y Hora</label>
                <input type="datetime-local" class="form-control" id="fechaHora" v-model="datosContacto.fechaHora" required>
              </div>
              
              <div class="mb-3">
                <label for="invitados" class="form-label">Cantidad de Invitados</label>
                <input type="number" class="form-control" id="invitados" v-model="datosContacto.invitados" required>
              </div>
              
              <div class="mb-3">
                <label for="direccion" class="form-label">Direcci√≥n y Comuna</label>
                <input type="text" class="form-control" id="direccion" v-model="datosContacto.direccion" required>
              </div>
              
              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre y Apellidos</label>
                <input type="text" class="form-control" id="nombre" v-model="datosContacto.nombre" required>
              </div>
              
              <div class="mb-3">
                <label for="telefono" class="form-label">Celular</label>
                <input type="tel" class="form-control" id="telefono" v-model="datosContacto.telefono" placeholder="+569-12345678" required>
              </div>
              
              <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" v-model="datosContacto.email" required>
              </div>
              
              <div class="mb-3">
                <label for="comentarios" class="form-label">Comentarios</label>
                <textarea class="form-control" id="comentarios" rows="3" v-model="datosContacto.comentarios"></textarea>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="card position-sticky" style="top: 20px;">
          <div class="card-body">
            <h5 class="card-title mb-3">Resumen</h5>
            
            <div v-if="productosSeleccionados.length > 0">
              <div v-for="(producto, index) in productosSeleccionados" :key="index" class="d-flex justify-content-between mb-2">
                <div>
                  {{ producto.nombre }} ({{ producto.tamanoSeleccionado.nombre }}) √ó {{ producto.cantidad }}
                </div>
                <div>${{ formatPrice(producto.subtotal) }}</div>
              </div>
              
              <hr>
              <div class="d-flex justify-content-between fw-bold">
                <div>Total</div>
                <div>${{ formatPrice(totalGeneral) }}</div>
              </div>
            </div>
            <div v-else class="text-center text-muted py-3">
              Selecciona productos
            </div>
            
            <button @click="enviarCotizacion" class="btn btn-success w-100 mt-3" :disabled="productosSeleccionados.length === 0">
              <i class="bi bi-whatsapp"></i> Enviar Cotizaci√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, onMounted } = Vue;
    
    createApp({
      setup() {
        const productos = ref([
          {
            nombre: 'Pisco Sour Cl√°sico',
            descripcion: 'Pisco Transparente, Lim√≥n Sutil, Az√∫car, Alb√∫mina.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 69990, emoji: 'üçã' },
              { id: 2, nombre: 'Barril 10L', precio: 129990, emoji: 'üçã' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Caipiri√±a',
            descripcion: 'Cacha√ßa, Lim√≥n y Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 69990, emoji: 'üçã' },
              { id: 2, nombre: 'Barril 10L', precio: 129990, emoji: 'üçã' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Gin and Tonic',
            descripcion: 'Cacha√ßa, Lim√≥n y Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 79990, emoji: 'üç∏' },
              { id: 2, nombre: 'Barril 10L', precio: 149990, emoji: 'üç∏' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Sangr√≠a',
            descripcion: 'Vino Tinto CS, Triple Sec, Destilado A√±ejado, Naranja, Lim√≥n.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 79990, emoji: 'üç∑' },
              { id: 2, nombre: 'Barril 10L', precio: 149990, emoji: 'üç∑' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Mojito Tradicional',
            descripcion: 'Ron Blanco, Agua Mineral Gasificada, Lim√≥n, Menta, Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 79990, emoji: 'üåø' },
              { id: 2, nombre: 'Barril 10L', precio: 149990, emoji: 'üåø' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Mojito Frambuesa',
            descripcion: 'Ron Blanco, Agua Mineral Gasificada, Frambuesa, Lim√≥n, Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 84990, emoji: 'üçì' },
              { id: 2, nombre: 'Barril 10L', precio: 159990, emoji: 'üçì' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Mojito Maracuy√°',
            descripcion: 'Ron Blanco, Agua Mineral Gasificada, Maracuy√°, Lim√≥n, Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 84990, emoji: 'üçì' },
              { id: 2, nombre: 'Barril 10L', precio: 159990, emoji: 'üçì' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Ramazzotti Spritz',
            descripcion: 'Ramazzotti, Espumante Brut, Agua Mineral Gasificada.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 99990, emoji: 'üçπ' },
              { id: 2, nombre: 'Barril 10L', precio: 189990, emoji: 'üçπ' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Aperol Spritz',
            descripcion: 'Aperol, Espumante Brut, Agua Mineral Gasificada.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 99990, emoji: 'üçä' },
              { id: 2, nombre: 'Barril 10L', precio: 189990, emoji: 'üçä' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Tequila Margarita',
            descripcion: 'Tequila Blanco, Triple Sec, Lim√≥n, Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 99990, emoji: 'üçπ' },
              { id: 2, nombre: 'Barril 10L', precio: 189990, emoji: 'üçπ' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Tropical Gin',
            descripcion: 'Gin, Red Bull Tropical.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 99990, emoji: 'üçπ' },
              { id: 2, nombre: 'Barril 10L', precio: 189990, emoji: 'üçπ' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          },
          {
            nombre: 'Mojito Sin Alcohol',
            descripcion: 'Agua Mineral, Lim√≥n, Menta, Az√∫car.',
            tamanos: [
              { id: 1, nombre: 'Barril 5L', precio: 59990, emoji: 'üçã' },
              { id: 2, nombre: 'Barril 10L', precio: 110990, emoji: 'üçã' }
            ],
            tamanoSeleccionado: null,
            cantidad: 0,
            subtotal: 0
          }
        ]);

        const datosContacto = ref({
          fechaHora: '',
          invitados: '',
          direccion: '',
          nombre: '',
          telefono: '',
          email: '',
          comentarios: ''
        });

        // Inicializar tama√±oSeleccionado para cada producto
        onMounted(() => {
          productos.value.forEach(producto => {
            producto.tamanoSeleccionado = producto.tamanos[0];
          });
        });

        const productosSeleccionados = computed(() => {
          return productos.value.filter(p => p.cantidad > 0);
        });

        const totalGeneral = computed(() => {
          return productosSeleccionados.value.reduce((total, producto) => {
            return total + producto.subtotal;
          }, 0);
        });

        function formatPrice(price) {
          return new Intl.NumberFormat('es-CL').format(price);
        }

        function incrementarCantidad(producto) {
          producto.cantidad++;
          calcularSubtotal(producto);
        }

        function decrementarCantidad(producto) {
          if (producto.cantidad > 0) {
            producto.cantidad--;
            calcularSubtotal(producto);
          }
        }

        function validarCantidad(producto) {
          // Convertir a n√∫mero y asegurar que no sea negativo
          producto.cantidad = Math.max(0, parseInt(producto.cantidad) || 0);
          calcularSubtotal(producto);
        }

        function actualizarPrecio(producto) {
          calcularSubtotal(producto);
        }

        function calcularSubtotal(producto) {
          producto.subtotal = producto.tamanoSeleccionado.precio * producto.cantidad;
        }

        function enviarCotizacion() {
          if (productosSeleccionados.value.length === 0) {
            alert('Por favor selecciona al menos un producto');
            return;
          }

          // Validar formulario
          const form = document.querySelector('form');
          if (!form.checkValidity()) {
            form.reportValidity();
            return;
          }

          // Construir mensaje para WhatsApp
          let mensaje = `*Cotizaci√≥n de C√≥cteles*\n\n`;
          mensaje += `*Datos del Evento:*\n`;
          mensaje += `üìÖ Fecha y Hora: ${datosContacto.value.fechaHora}\n`;
          mensaje += `üë• Invitados: ${datosContacto.value.invitados}\n`;
          mensaje += `üìç Direcci√≥n: ${datosContacto.value.direccion}\n`;
          mensaje += `üë§ Nombre: ${datosContacto.value.nombre}\n`;
          mensaje += `üì± Tel√©fono: ${datosContacto.value.telefono}\n`;
          mensaje += `üìß Email: ${datosContacto.value.email}\n`;
          
          if (datosContacto.value.comentarios) {
            mensaje += `üí¨ Comentarios: ${datosContacto.value.comentarios}\n`;
          }
          
          mensaje += `\n*Productos Seleccionados:*\n`;
          productosSeleccionados.value.forEach(producto => {
            mensaje += `‚Ä¢ ${producto.nombre} (${producto.tamanoSeleccionado.nombre}) √ó ${producto.cantidad}: $${formatPrice(producto.subtotal)}\n`;
          });
          
          mensaje += `\n*Total: $${formatPrice(totalGeneral.value)}*`;
          
          // Codificar mensaje para URL
          const mensajeURL = encodeURIComponent(mensaje);
          
          // Abrir WhatsApp
          window.open(`https://wa.me/?text=${mensajeURL}`, '_blank');
        }

        return {
          productos,
          datosContacto,
          productosSeleccionados,
          totalGeneral,
          formatPrice,
          incrementarCantidad,
          decrementarCantidad,
          validarCantidad,
          actualizarPrecio,
          calcularSubtotal,
          enviarCotizacion
        };
      }
    }).mount('#app');
  </script>
</body>
</html>