<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotización de Cócteles en Barril</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .floating-form {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container py-5">
            <h2>¡Cotiza tus Cócteles en Barril!</h2>
            <p class="lead">Selecciona tus cócteles y completa el formulario para recibir tu cotización.</p>

            <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                <div v-for="(producto, index) in productos" :key="index" class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="fw-bold">{{ producto.nombre }}</h6>
                            <p class="text-muted small">{{ producto.descripcion }}</p>
                            <label for="tamaño" class="form-label small">Tamaño</label>
                            <select
                                class="form-select form-select-sm"
                                v-model="producto.tamañoSeleccionado"
                                @change="actualizarPrecio(producto)"
                                id="tamaño"
                            >
                                <option v-for="(precio, tamaño) in producto.precios" :key="tamaño" :value="tamaño">
                                    {{ tamaño }} - ${{ precio.toLocaleString('es-CL') }}
                                </option>
                            </select>
                            <div class="d-flex gap-2 mt-2 align-items-center">
                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="decrementarCantidad(producto)">-</button>
                                <input
                                    type="number"
                                    class="form-control form-control-sm text-center"
                                    v-model.number="producto.cantidad"
                                    @input="validarCantidad(producto)"
                                >
                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="incrementarCantidad(producto)">+</button>
                                <span class="ms-auto fw-bold small">Subtotal: ${{ calcularSubtotalProducto(producto).toLocaleString('es-CL') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="mt-4">Tu Selección:</h3>
            <ul v-if="productosSeleccionados.length > 0" class="list-group mb-4">
                <li v-for="producto in productosSeleccionados" :key="producto.nombre" class="list-group-item d-flex justify-content-between align-items-center">
                    <span>{{ producto.nombre }} ({{ producto.tamañoSeleccionado }}, Cantidad: {{ producto.cantidad }})</span>
                    <span class="badge bg-primary rounded-pill">${calcularSubtotalProducto(producto).toLocaleString('es-CL')}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center fw-bold">
                    <span>Total General:</span>
                    <span>${totalGeneral.toLocaleString('es-CL')}</span>
                </li>
            </ul>
            <p v-else>Aún no has seleccionado ningún cóctel.</p>

            <div class="card mt-4">
                <div class="card-body">
                    <h3 class="mb-3">Datos de tu Evento</h3>
                    <form @submit.prevent="enviarCotizacionWhatsApp">
                        <div class="mb-3">
                            <label for="fechaHora" class="form-label">Fecha y Hora del Evento <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" id="fechaHora" v-model="formData.fechaHora" required>
                        </div>
                        <div class="mb-3">
                            <label for="invitados" class="form-label">Número de Invitados</label>
                            <input type="number" class="form-control" id="invitados" v-model="formData.invitados">
                        </div>
                        <div class="mb-3">
                            <label for="direccion" class="form-label">Dirección del Evento <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="direccion" v-model="formData.direccion" required>
                        </div>
                        <div class="mb-3">
                            <label for="nombreContacto" class="form-label">Nombre de Contacto <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="nombreContacto" v-model="formData.nombreContacto" required>
                        </div>
                        <div class="mb-3">
                            <label for="emailContacto" class="form-label">Email de Contacto</label>
                            <input type="email" class="form-control" id="emailContacto" v-model="formData.emailContacto">
                        </div>
                        <div class="mb-3">
                            <label for="telefonoContacto" class="form-label">Teléfono de Contacto <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="telefonoContacto" v-model="formData.telefonoContacto" required>
                        </div>
                        <button type="submit" class="btn btn-success">Enviar Cotización por WhatsApp</button>
                    </form>
                </div>
            </div>
        </div>

        <div v-if="isDesktop && showFloatingForm" class="floating-form bg-light p-3 border rounded shadow">
            <h5>Resumen de tu Cotización</h5>
            <ul v-if="productosSeleccionados.length > 0" class="list-unstyled">
                <li v-for="producto in productosSeleccionados" :key="producto.nombre" class="mb-1">
                    {{ producto.nombre }} ({{ producto.tamañoSeleccionado }}): {{ producto.cantidad }}
                </li>
            </ul>
            <p v-else class="small text-muted">Aún no has seleccionado nada.</p>
            <p class="fw-bold mb-0">Total: ${{ totalGeneral.toLocaleString('es-CL') }}</p>
            <button class="btn btn-primary btn-sm mt-2" @click="scrollToForm">Completar Datos</button>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script type="text/javascript">
        const { createApp, ref, computed, reactive, onMounted, onBeforeUnmount } = Vue;

        createApp({
            setup() {
                const productosData = [
                  {
                    nombre: 'Pisco Sour',
                    descripcion: 'El clásico cóctel peruano con limón y clara de huevo.',
                    precios: {
                      '5L': 69990,
                      '10L': 129990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Caipiriña',
                    descripcion: 'Refrescante cóctel brasileño a base de cachaza y lima.',
                    precios: {
                      '5L': 69990,
                      '10L': 129990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Gin and Tonic',
                    descripcion: 'La combinación perfecta de ginebra y agua tónica.',
                    precios: {
                      '5L': 79990,
                      '10L': 149990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Sangría',
                    descripcion: 'Bebida refrescante a base de vino tinto y frutas.',
                    precios: {
                      '5L': 79990,
                      '10L': 149990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Mojito',
                    descripcion: 'Cóctel cubano con ron, menta, azúcar, limón y soda.',
                    precios: {
                      '5L': 79990,
                      '10L': 149990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Mojito Sabor',
                    descripcion: 'Delicioso mojito con un toque de frutilla fresca.',
                    precios: {
                      '5L': 84990,
                      '10L': 159990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Aperol Spritz',
                    descripcion: 'El aperitivo italiano de moda con Aperol, Prosecco y soda.',
                    precios: {
                      '5L': 99990,
                      '10L': 189990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Ramazzotti Spritz',
                    descripcion: 'Una variante refrescante con el sabor único de Ramazzotti.',
                    precios: {
                      '5L': 99990,
                      '10L': 189990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Tequila Margarita',
                    descripcion: 'El clásico cóctel mexicano con tequila, limón y sal.',
                    precios: {
                      '5L': 99990,
                      '10L': 189990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Tropical Gin',
                    descripcion: 'Una explosión de sabores tropicales con ginebra.',
                    precios: {
                      '5L': 99990,
                      '10L': 189990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                  {
                    nombre: 'Mojito Sin Alcohol',
                    descripcion: 'El refrescante sabor del mojito, pero sin alcohol.',
                    precios: {
                      '5L': 59990,
                      '10L': 110990,
                    },
                    tamañoSeleccionado: '5L',
                    cantidad: 0,
                  },
                ];

                const productos = ref(productosData);
                const formData = reactive({
                  fechaHora: '',
                  invitados: '',
                  direccion: '',
                  nombreContacto: '',
                  emailContacto: '',
                  telefonoContacto: '',
                });

                const isDesktop = ref(window.innerWidth >= 992);
                const showFloatingForm = ref(false);
                const floatingFormOffset = ref(null);

                onMounted(() => {
                  window.addEventListener('resize', handleResize);
                  window.addEventListener('scroll', handleScroll);
                  floatingFormOffset.value = document.getElementById('fechaHora')?.offsetTop;
                });

                onBeforeUnmount(() => {
                  window.removeEventListener('resize', handleResize);
                  window.removeEventListener('scroll', handleScroll);
                });

                const handleResize = () => {
                  isDesktop.value = window.innerWidth >= 992;
                };

                const handleScroll = () => {
                  if (isDesktop.value && floatingFormOffset.value !== null) {
                    showFloatingForm.value = window.scrollY >= floatingFormOffset.value;
                  } else {
                    showFloatingForm.value = false;
                  }
                };

                const scrollToForm = () => {
                  const formElement = document.querySelector('form');
                  if (formElement) {
                    formElement.scrollIntoView({ behavior: 'smooth' });
                  }
                };

                const productosSeleccionados = computed(() => {
                  return productos.value.filter(producto => producto.cantidad > 0);
                });

                const totalGeneral = computed(() => {
                  return productosSeleccionados.value.reduce((total, producto) => {
                    const precio = producto.precios[producto.tamañoSeleccionado] || 0;
                    return total + precio * producto.cantidad;
                  }, 0);
                });

                const actualizarPrecio = (producto) => {
                    // No es necesario hacer nada extra aquí, el precio ya está en el objeto y se usa en el cálculo.
                    // Este método podría ser útil si tuvieras lógica de precios más compleja.
                };

                const incrementarCantidad = (producto) => {
                  producto.cantidad++;
                };

                const decrementarCantidad = (producto) => {
                  if (producto.cantidad > 0) {
                    producto.cantidad--;
                  }
                };

                const validarCantidad = (producto) => {
                  if (producto.cantidad < 0) {
                    producto.cantidad = 0;
                  }
                };

                const calcularSubtotalProducto = (producto) => {
                  const precio = producto.precios[producto.tamañoSeleccionado] || 0;
                  return precio * producto.cantidad;
                };

                const enviarCotizacionWhatsApp = () => {
                  if (!formData.fechaHora || !formData.direccion || !formData.nombreContacto || !formData.telefonoContacto) {
                    alert('Por favor, completa los campos obligatorios.');
                    return;
                  }

                  const mensaje = `¡Hola! Quiero solicitar una cotización de cócteles en barril:\n\n`;
                  mensaje += `*Datos del Evento:*\n`;
                  mensaje += `Fecha y Hora: ${formData.fechaHora}\n`;
                  if (formData.invitados) {
                    mensaje += `Número de Invitados: ${formData.invitados}\n`;
                  }
                  mensaje += `Dirección: ${formData.direccion}\n`;
                  mensaje += `\n*Contacto:*\n`;
                  mensaje += `Nombre: ${formData.nombreContacto}\n`;
                  if (formData.emailContacto) {
                    mensaje += `Email: ${formData.emailContacto}\n`;
                  }
                  mensaje += `Teléfono: ${formData.telefonoContacto}\n`;
                  mensaje += `\n*Productos Seleccionados:*\n`;

                  if (productosSeleccionados.value.length > 0) {
                    productosSeleccionados.value.forEach(producto => {
                      mensaje += `- ${producto.nombre} (${producto.tamañoSeleccionado}) - Cantidad: ${producto.cantidad} - Subtotal: $${calcularSubtotalProducto(producto).toLocaleString('es-CL')}\n`;
                    });
                    mensaje += `\n*Total General: $${totalGeneral.value.toLocaleString('es-CL')}*\n`;
                  } else {
                    mensaje += `No se han seleccionado productos.\n`;
                  }

                  const telefonoWhatsApp = '+569XXXXXXXXX'; // Reemplaza con el número de teléfono de tu negocio
                  const urlWhatsApp = `https://wa.me/${telefonoWhatsApp}?text=${encodeURIComponent(mensaje)}`;
                  window.open(urlWhatsApp, '_blank');
                };

                return {
                  productos,
                  formData,
                  isDesktop,
                  showFloatingForm,
                  productosSeleccionados,
                  totalGeneral,
                  actualizarPrecio,
                  incrementarCantidad,
                  decrementarCantidad,
                  validarCantidad,
                  calcularSubtotalProducto,
                  enviarCotizacionWhatsApp,
                  scrollToForm,
                };
            },
            template: `
              <div>
                <div class="container py-5">
                  <h2>¡Cotiza tus Cócteles en Barril!</h2>
                  <p class="lead">Selecciona tus cócteles y completa el formulario para recibir tu cotización.</p>

                  <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                    <div v-for="(producto, index) in productos" :key="index" class="col">
                      <div class="card h-100">
                        <div class="card-body">
                          <h6 class="fw-bold">{{ producto.nombre }}</h6>
                          <p class="text-muted small">{{ producto.descripcion }}</p>
                          <label for="tamaño" class="form-label small">Tamaño</label>
                          <select
                            class="form-select form-select-sm"
                            v-model="producto.tamañoSeleccionado"
                            @change="actualizarPrecio(producto)"
                            id="tamaño"
                          >
                            <option v-for="(precio, tamaño) in producto.precios" :key="tamaño" :value="tamaño">
                              {{ tamaño }} - ${{ precio.toLocaleString('es-CL') }}
                            </option>
                          </select>
                          <div class="d-flex gap-2 mt-2 align-items-center">
                            <button type="button" class="btn btn-outline-secondary btn-sm" @click="decrementarCantidad(producto)">-</button>
                            <input
                              type="number"
                              class="form-control form-control-sm text-center"
                              v-model.number="producto.cantidad"
                              @input="validarCantidad(producto)"
                            >
                            <button type="button" class="btn btn-outline-secondary btn-sm" @click="incrementarCantidad(producto)">+</button>
                            <span class="ms-auto fw-bold small">Subtotal: ${{ calcularSubtotalProducto(producto).toLocaleString('es-CL') }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <h3 class="mt-4">Tu Selección:</h3>
                  <ul v-if="productosSeleccionados.length > 0" class="list-group mb-4">
                    <li v-for="producto in productosSeleccionados" :key="producto.nombre" class="list-group-item d-flex justify-content-between align-items-center">
                      <span>{{ producto.nombre }} ({{ producto.tamañoSeleccionado }}, Cantidad: {{ producto.cantidad }})</span>
                      <span class="badge bg-primary rounded-pill">${calcularSubtotalProducto(producto).toLocaleString('es-CL')}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center fw-bold">
                      <span>Total General:</span>
                      <span>${totalGeneral.toLocaleString('es-CL')}</span>
                    </li>
                  </ul>
                  <p v-else>Aún no has seleccionado ningún cóctel.</p>

                  <div class="card mt-4">
                    <div class="card-body">
                      <h3 class="mb-3">Datos de tu Evento</h3>
                      <form @submit.prevent="enviarCotizacionWhatsApp">
                        <div class="mb-3">
                          <label for="fechaHora" class="form-label">Fecha y Hora del Evento <span class="text-danger">*</span></label>
                          <input type="datetime-local" class="form-control" id="fechaHora" v-model="formData.fechaHora" required>
                        </div>
                        <div class="mb-3">
                          <label for="invitados" class="form-label">Número de Invitados</label>
                          <input type="number" class="form-control" id="invitados" v-model="formData.invitados">
                        </div>
                        <div class="mb-3">
                          <label for="direccion" class="form-label">Dirección del Evento <span class="text-danger">*</span></label>
                          <input type="text" class="form-control" id="direccion" v-model="formData.direccion" required>
                        </div>
                        <div class="mb-3">
                          <label for="nombreContacto" class="form-label">Nombre de Contacto <span class="text-danger">*</span></label>
                          <input type="text" class="form-control" id="nombreContacto" v-model="formData.nombreContacto" required>
                        </div>
                        <div class="mb-3">
                          <label for="emailContacto" class="form-label">Email de Contacto</label>
                          <input type="email" class="form-control" id="emailContacto" v-model="formData.emailContacto">
                        </div>
                        <div class="mb-3">
                          <label for="telefonoContacto" class="form-label">Teléfono de Contacto <span class="text-danger">*</span></label>
                          <input type="tel" class="form-control" id="telefonoContacto" v-model="formData.telefonoContacto" required>
                        </div>
                        <button type="submit" class="btn btn-success">Enviar Cotización por WhatsApp</button>
                      </form>
                    </div>
                  </div>
                </div>

                <div v-if="isDesktop && showFloatingForm" class="floating-form bg-light p-3 border rounded shadow">
                  <h5>Resumen de tu Cotización</h5>
                  <ul v-if="productosSeleccionados.length > 0" class="list-unstyled">
                    <li v-for="producto in productosSeleccionados" :key="producto.nombre" class="mb-1">
                      {{ producto.nombre }} ({{ producto.tamañoSeleccionado }}): {{ producto.cantidad }}
                    </li>
                  </ul>
                  <p v-else class="small text-muted">Aún no has seleccionado nada.</p>
                  <p class="fw-bold mb-0">Total: ${{ totalGeneral.toLocaleString('es-CL') }}</p>
                  <button class="btn btn-primary btn-sm mt-2" @click="scrollToForm">Completar Datos</button>
                </div>
              </div>
            `
        }).mount('#app');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
